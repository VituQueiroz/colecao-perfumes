<!DOCTYPE html>
<html lang="pt-br" data-bs-theme="dark">
<head>
<meta charset="UTF-8" />

<!-- üî• IMPORTANTE PARA CELULAR -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Cole√ß√£o de Perfumes</title>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
<script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
<link rel="icon" type="image/png" href="https://icons.iconarchive.com/icons/iconarchive/mothers-day/48/Perfume-Bottle-icon.png">

<style>

/* ===== FUNDO OTIMIZADO PARA CELULAR ===== */
body { 
    font-family: "Poppins", sans-serif; 
    background: url("https://images.unsplash.com/photo-1485470733090-0aae1788d5af?fm=jpg&q=60&w=1500") no-repeat center center;
    background-size: cover; 
    background-attachment: scroll;
    backdrop-filter: blur(2px); 
    color:#fff;
}

/* ===== TEXTOS ===== */
h1,h2,h5,p,label { color:#fff; }

/* ===== CONTAINER GLASS ===== */
.glass-box { 
    background: rgba(0,0,0,0.35); 
    border: 1px solid rgba(255,255,255,0.15); 
    border-radius: 16px; 
    padding: 12px;
    box-shadow: 0 6px 25px rgba(0,0,0,0.5); 
    backdrop-filter: blur(10px); 
}

/* ===== FORM ===== */
.form-control { 
    border: 1px solid #666 !important; 
    background-color: rgba(0,0,0,0.3); 
    color: #fff; 
    font-size: 0.85rem;
    padding: 6px 10px;
}
.form-control:focus { 
    border-color: #aaa !important; 
    box-shadow: 0 0 0 0.2rem rgba(200,200,200,0.2); 
}

/* ===== ACCORDION ===== */
.accordion-button { 
    background: rgba(0,0,0,0.3) !important; 
    color: #fff !important; 
    border: none !important; 
    font-size: 0.85rem;
}
.accordion-body { 
    background: rgba(0,0,0,0.2); 
    border-radius: 10px; 
    padding: 8px 12px; 
    font-size: 0.75rem;
}

/* ===== CARDS ===== */
.card-wrap { perspective: 1000px; position: relative; }

.perfume-card { 
    background: rgba(0,0,0,0.25); 
    border: 1px solid rgba(255,255,255,0.2); 
    border-radius: 14px; 
    padding: 10px; 
    backdrop-filter: blur(6px); 
    cursor: pointer;
    transition: transform .25s ease, box-shadow .3s ease, background .3s ease; 
    transform-origin: center;
    position: relative; 
    font-size: 0.8rem;
}

@media (hover:hover) {
    .perfume-card:hover { 
        transform: translateY(-4px); 
        box-shadow: 0 10px 35px rgba(0,0,0,0.65); 
    }
}

.perfume-img { 
    width: 80px; 
    height: 80px; 
    object-fit: cover; 
    border-radius: 12px; 
    border: 2px solid #fff; 
    transition: transform .3s ease; 
}

@media (hover:hover) {
    .perfume-card:hover .perfume-img { transform: scale(1.05); }
}

/* ===== FAVORITO ===== */
.favorite { 
    position: absolute; 
    top: 8px; right: 8px; 
    font-size: 1.4rem; 
    cursor: pointer; 
    z-index: 2;
}
.favorite:hover { transform: scale(1.15); }
.favorite i.far { color: white; }
.favorite i.fas { color: red; }
.favorite:not(.favorito) i.far:hover { color: red !important; }

/* ===== EXPANDIR ===== */
.collapse-content { display: none; margin-top: 6px; }
.collapse-content.show { display: block; }

/* ===== BOT√ïES ===== */
.button-row {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-top: 10px;
}
.button-row .btn {
    flex: 1 1 calc(50% - 6px);
    white-space: nowrap;
}

/* BADGES */
.badge-oc, .badge-nota {
    margin-right: 3px;
    margin-bottom: 3px;
    padding: 4px 8px;
    border-radius: 5px;
    font-size: 0.65rem;
}
.badge-cat {
    margin-right: 3px;
    margin-bottom: 3px;
    padding: 4px 8px;
    border-radius: 5px;
    font-size: 0.65rem;
    white-space: normal; /* permite quebra de linha */
    display: inline-block; /* mant√©m o estilo de badge */
}


/* CORES */
.bg-brown { background:#8d6e63 !important; color:white !important; }
.bg-yellow { background:#f7d700 !important; color:black !important; }
.bg-pink { background:#ff4fa3 !important; color:white !important; }
.bg-skyblue { background:#5bc0de !important; color:black !important; }
.bg-red { background:#dc3545 !important; }
.bg-orange { background:#fd7e14 !important; }
.bg-cyan { background:#0dcaf0 !important; color:black !important; }
.bg-green { background:#198754 !important; }
.bg-purple { background:#6f42c1 !important; }
.bg-darkgreen { background:#14532d !important; }

/* ===== ESTRELAS ===== */
.star { cursor: pointer; font-size: 1rem; }
.star.fas { color: #ffc107 !important; }
.star.far { color: #6c757d !important; }

@media (hover:hover) {
    .star:hover { transform: scale(1.15); transition: 0.2s; }
}
.upload-area {
  text-align: center;
  color: #fff;
}

.upload-box {
  padding: 20px;
  border: 2px dashed rgba(255,255,255,0.4);
  border-radius: 10px;
  cursor: pointer;
  transition: .3s;
}

.upload-box:hover {
  background: rgba(255,255,255,0.08);
  border-color: rgba(255,255,255,0.8);
}
.obrigatorio {
  color: red;
  font-weight: bold;
  margin-left: 3px;
}
@media(max-width: 576px){
  .glass-box {
      margin-left: 10px;
      margin-right: 10px;
  }
}

</style>
</head>

<body>
<div id="app">

<nav class="navbar navbar-dark bg-dark mb-3 rounded shadow p-2">
  <div class="container-fluid">
    <a class="navbar-brand" href="#" @click.prevent="irParaLista">
      <i class="fa fa-th"></i> Lista
    </a>
    
    <a class="navbar-brand" href="#" @click.prevent="irParaCadastro">
      <i class="fa fa-plus"></i> Cadastro
    </a>
    
    <a class="navbar-brand" href="#" @click.prevent="irParaWishlist">
    <i class="fa fa-star"></i> Lista de Desejos
    </a>

  </div>
</nav>

<div class="container py-3">

<header class="text-center mb-3">
    <h1 style="font-size:1.6rem;">Minha Cole√ß√£o de Perfumes</h1>
</header>

<div class="row g-3">

<!-- ========================= -->
<!--   FORMUL√ÅRIO CENTRALIZADO -->
<!-- ========================= -->
<div v-if="tela==='cadastro'" class="d-flex justify-content-center w-100">
  <div class="col-12 col-md-3">
    <div class="glass-box">

      <h2 style="font-size:1.1rem;">{{ editIndex !== null ? "Editar Perfume" : "Cadastrar Perfume" }}</h2>

      <label class="mt-2">Nome <span class="obrigatorio">*</span></label>
      <input class="form-control" placeholder="Nome" v-model="nome">

      <label class="mt-2">Marca <span class="obrigatorio">*</span></label>
      <input class="form-control" placeholder="Marca" v-model="marca">

      <label class="mt-2">Site fabricante <span class="obrigatorio">*</span></label>
      <input class="form-control" placeholder="Site fabricante" v-model="site">

<!-- √ÅREA DE UPLOAD -->
<div class="upload-area mt-2"
     @dragover.prevent
     @drop.prevent="soltarImagem"
     @paste="colarImagem">

     <p class="mb-1" style="font-size:0.8rem;">
      <span class="obrigatorio">*</span> Arraste a imagem aqui, clique para escolher ou use CTRL+V
    </p>
    

  <input type="file" accept="image/*" class="d-none" ref="fileInput" @change="carregarImagem">
  
  <div class="upload-box" @click="$refs.fileInput.click()">
    <i class="fa fa-cloud-upload fa-2x mb-2"></i>
    <p>Clique ou solte a imagem aqui</p>
  </div>
</div>

<!-- Pr√©-visualiza√ß√£o com √≠cone de remover -->
<div v-if="imagem" class="position-relative d-inline-block mt-2">
  <img :src="imagem" class="img-fluid rounded shadow" style="max-height:120px;">
  
  <!-- √çcone para remover -->
  <span @click="imagem=''" 
        style="position:absolute; top:0; right:0; background:rgba(0,0,0,0.6); 
               border-radius:50%; padding:2px 6px; cursor:pointer; color:white;">
    <i class="fas fa-times"></i>
  </span>
</div>



      <label class="mt-2">Volume (ml) <span class="obrigatorio">*</span></label>
      <input class="form-control" type="number" placeholder="Volume (ml)" v-model="volume">

      <input class="form-control mt-2" type="number" placeholder="Ano lan√ßamento" v-model="ano">
      <label class="mt-2">Pre√ßo (R$) <span class="obrigatorio">*</span></label>
      <input class="form-control" type="number" placeholder="Pre√ßo (R$)" v-model="preco">


      <!-- ACCORDIONS -->
      <div class="accordion mt-3" id="accordionForm">

<div class="accordion-item bg-transparent">
  <h2 class="accordion-header">
    <button class="accordion-button" type="button" @click="toggleAba('oc')">
      Ocasi√µes
    </button>
  </h2>

  <div :class="'accordion-collapse collapse ' + (abasAbertas.oc ? 'show' : '')">
    <div class="accordion-body">
      
      <div v-for="oc in opcoesOcasi√µes" :key="oc" class="form-check">
        <input 
          class="form-check-input"
          type="checkbox"
          :id="'oc-' + oc"
          :value="oc"
          v-model="ocasi√µes"
        >
        <label class="form-check-label" :for="'oc-' + oc">
          {{ oc }}
        </label>
      </div>

    </div>
  </div>
</div>


        <div class="accordion-item bg-transparent mt-2">
          <h2 class="accordion-header">
            <button class="accordion-button" type="button" @click="toggleAba('pref')">Prefer√™ncias</button>
          </h2>
          <div :class="'accordion-collapse collapse ' + (abasAbertas.pref ? 'show':'' )">
            <div class="accordion-body">
              <select class="form-control mt-1" v-model="tempo">
                <option disabled value="">Dia ou Noite?</option>
                <option>Dia</option>
                <option>Noite</option>
              </select>
              <select class="form-control mt-1" v-model="estacao">
                <option disabled value="">Frio ou Calor?</option>
                <option>Frio</option>
                <option>Calor</option>
              </select>
            </div>
          </div>
        </div>

<div class="accordion-item bg-transparent mt-2">
  <h2 class="accordion-header">
    <button class="accordion-button" type="button" @click="toggleAba('notas')">
      Notas Olfativas
    </button>
  </h2>

  <div :class="'accordion-collapse collapse ' + (abasAbertas.notas ? 'show' : '')">
    <div class="accordion-body">
      
      <div v-for="nota in opcoesNotasAromaticas" :key="nota" class="form-check">
        <input 
          class="form-check-input"
          type="checkbox"
          :id="'nota-' + nota"
          :value="nota"
          v-model="notasSelecionadas"
        >
        <label class="form-check-label" :for="'nota-' + nota">
          {{ nota }}
        </label>
      </div>

    </div>
  </div>
</div>


      </div>

      <h5 class="mt-3">Extras</h5>
      <input class="form-control" v-model="extras">

      <button class="btn btn-primary w-100 mt-3" :disabled="!podeSalvar" @click="cadastrarPerfume">
        {{ editIndex !== null ? "Salvar Altera√ß√µes" : "Cadastrar Perfume" }}
      </button>

      <button class="btn btn-secondary w-100 mt-2" 
        v-if="temAlgoNoFormulario" 
        @click="cancelarEdicao">
        Cancelar
      </button>


      <button class="btn btn-success w-100 mt-2" @click="exportarColecaoCompleta">
        Exportar Cole√ß√£o
      </button>

      <input type="file" id="importarArquivo" style="display:none" @change="importarColecaoCompleta">

      <button class="btn btn-warning w-100 mt-2" @click="abrirImportacao">
        Importar Cole√ß√£o
      </button>

    </div>
  </div>
</div>

<!-- ============================= -->
<!--     GRID CENTRALIZADO        -->
<!-- ============================= -->
<div v-if="tela==='grid'" class="d-flex justify-content-center w-100">
<div class="col-12 col-md-9">
  <div class="glass-box">

    <div class="d-flex gap-2 mb-2 align-items-center">
      <input class="form-control" placeholder="Buscar..." v-model="filtroGeral" style="font-size:0.85rem;">

      <select class="form-control w-auto" v-model="sortBy" style="font-size:0.85rem;">
        <option value="none">Ordenar</option>
        <option value="nome_az">Nome (A ‚Üí Z)</option>
        <option value="nome_za">Nome (Z ‚Üí A)</option>
        <option value="preco_cresc">Menor Pre√ßo</option>
        <option value="preco_desc">Maior Pre√ßo</option>
        <option value="nota_cresc">Menor Nota</option>
        <option value="nota_desc">Maior Nota</option>
      </select>

      <label class="form-check-label ms-2" style="color:#fff;">
        <input class="form-check-input" type="checkbox" v-model="somenteFavoritos">
        Favoritos
      </label>
    </div>

    <div class="mb-2" style="font-size:0.8rem;">
      <strong>Total:</strong> {{ listaFiltrada.length }} |
      <strong>Valor:</strong> {{ valorTotal | reais }}
    </div>

    <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-3 justify-content-center">

      <div class="col" v-for="(perfume,index) in listaFiltradaSorted" :key="index">
        <div class="card-wrap">
          <div class="perfume-card" @click="toggleExpand(perfume)">

            <div v-if="!perfume.expandido" class="favorite" @click.stop="toggleFavorito(perfume)">
              <i :class="perfume.favorito ? 'fas fa-heart':'far fa-heart'"></i>
            </div>

            <div v-if="!perfume.expandido" class="text-center">
              <img :src="perfume.imagem" class="perfume-img mb-2">
              <h5>{{ perfume.nome }}</h5>
              <p class="mb-1"><strong>{{ perfume.preco | reais }}</strong></p>
              <p class="mb-0">
                <span v-for="n in 5" :key="n"
                  class="fa-star star"
                  :class="{'fas': n <= perfume.nota, 'far': n > perfume.nota}"
                  @click.stop="setNotaPerfume(perfume,n)">
                </span>
              </p>
            </div>

            <div class="collapse-content" :class="{'show': perfume.expandido}">
              <a v-if="perfume.site" :href="perfume.site" target="_blank" class="btn btn-success btn-sm position-absolute top-0 end-0 mt-1 me-1" title="Comprar">
                  <i class="fas fa-shopping-cart"></i>
                </a>

              <p><strong>Marca:</strong> {{ perfume.marca }}</p>
              <p><strong>Volume:</strong> {{ perfume.volume }} ml</p>
              <p><strong>Ano:</strong> {{ perfume.ano }}</p>
              <p><strong>Dia/Noite:</strong> {{ perfume.tempo }}</p>
              <p><strong>Esta√ß√£o:</strong> {{ perfume.estacao }}</p>

              <p><strong>Ocasi√µes:</strong><br>
                <span v-for="oc in perfume.ocasi√µes" :key="oc"
                      class="badge badge-oc" :class="'bg-' + badgeColorOc(oc)">
                {{ oc }}</span>
              </p>

              <p><strong>Notas:</strong><br>
                <span v-for="nota in perfume.notasSelecionadas" :key="nota"
                      class="badge badge-nota" :class="'bg-' + badgeColorNota(nota)">
                {{ nota }}</span>
              </p>

              <p><strong>Extras:</strong><br>
                <span class="badge badge-cat">{{ perfume.extras }}</span>
              </p>
            </div>

            <div class="button-row">
              <button class="btn btn-info btn-sm" @click.stop="duplicar(perfume)">Duplicar</button>
              <button class="btn btn-danger btn-sm" @click.stop="excluir(perfume)">Excluir</button>
              <button class="btn btn-success btn-sm" @click.stop="alterar(perfume)">Editar</button>
            </div>

          </div>
        </div>
      </div>

    </div>
  </div>
</div>
</div>

</div> <!-- row -->


<!-- ============================= -->
<!--     TELA LISTA DE DESEJOS     -->
<!-- ============================= -->
<div v-if="tela==='wishlist'" class="row justify-content-center w-100">

  <div class="col-12 col-md-3">
    <div class="glass-box">

      <h2 style="font-size:1.1rem;">Adicionar √† Lista de Desejos</h2>

      <label class="mt-2">Nome</label>
      <input class="form-control" v-model="wish_nome">

      <label class="mt-2">Marca</label>
      <input class="form-control" v-model="wish_marca">

      <label class="mt-2">Pre√ßo (R$)</label>
      <input class="form-control" type="number" v-model="wish_preco">

      <label class="mt-2">Link de Compra</label>
      <input class="form-control" placeholder="https://..." v-model="wish_site">


<!-- √ÅREA DE UPLOAD (mesma do cadastro) -->
<div class="upload-area mt-2"
     @dragover.prevent
     @drop.prevent="wish_soltarImagem"
     @paste="wish_colarImagem">

  <p class="mb-1" style="font-size:0.8rem;">
    <span class="obrigatorio">*</span> Arraste a imagem aqui, clique para escolher ou use CTRL+V
  </p>

  <input type="file" accept="image/*" class="d-none" ref="wish_fileInput" @change="wish_carregarImagem">

  <div class="upload-box" @click="$refs.wish_fileInput.click()">
    <i class="fa fa-cloud-upload fa-2x mb-2"></i>
    <p>Clique ou solte a imagem aqui</p>
  </div>
</div>

<!-- Pr√©-visualiza√ß√£o com √≠cone de remover -->
<div v-if="wish_imagem" class="position-relative d-inline-block mt-2">
  <img :src="wish_imagem" class="img-fluid rounded shadow" style="max-height:120px;">

  <span @click="wish_imagem=''" 
        style="position:absolute; top:0; right:0; background:rgba(0,0,0,0.6); 
               border-radius:50%; padding:2px 6px; cursor:pointer; color:white;">
    <i class="fas fa-times"></i>
  </span>
</div>


      <button class="btn btn-primary w-100 mt-3" @click="wishAdicionar">
        Adicionar
      </button>

    </div>
  </div>

  <!-- LISTA LATERAL -->
  <div class="col-12 col-md-6">
    <div class="glass-box">

      <h4>Itens na Lista de Desejos</h4>

      <div class="row row-cols-2 row-cols-md-3 g-3 mt-2">

        <div class="col" v-for="(p,i) in wishlist" :key="i">
          <div class="perfume-card text-center">

            <img :src="p.imagem" class="perfume-img mb-2">
            <h5>{{ p.nome }}</h5>
            <p>{{ p.marca }}</p>
            <p><strong>{{ p.preco | reais }}</strong></p>
            <a v-if="p.site"
              :href="p.site"
              target="_blank"
              class="btn btn-success btn-sm mb-1"
              title="Comprar">
              <i class="fas fa-shopping-cart"></i> Comprar
            </a>

            <button class="btn btn-success btn-sm mb-1" @click="wishMoverParaColecao(p)">
              Mover para a Cole√ß√£o
            </button>

            <button class="btn btn-danger btn-sm" @click="wishExcluir(p)">
              Remover
            </button>

          </div>
        </div>

      </div>

    </div>
  </div>

</div>
</div> <!-- container -->
<script>
new Vue({
  beforeDestroy() {
  window.removeEventListener("keydown", this.teclasForm);
},
  el:"#app",
  data:{
    wish_site: '',
    somenteFavoritos:false,
    nome:'', marca:'', imagem:'', volume:'', ano:'', preco:'',
    ocasi√µes:[], tempo:'', estacao:'', notasSelecionadas:[],
    extras:'', site:'', filtroGeral:'',
    opcoesOcasi√µes:["Dia a Dia","Profissional","Balada","Encontro","Faculdade","Academia","Casamento","Happy Hour"],
    opcoesNotasAromaticas:["Amadeirado","C√≠trico","Doce","Fresco","Oriental","Especiado","Aqu√°tico / Marinho","Arom√°tico","Frutado","Herbal"],
    listaPerfumes:[],
    abasAbertas:{ oc:false, pref:false, notas:false },
    editIndex:null,
    tela: 'grid',
    notaTemp:0,
    sortBy:'none',
    wishlist: [],
    wish_nome: '',
    wish_marca: '',
    wish_preco: '',
    wish_imagem: '',
  },
  mounted(){
    const saveWish = localStorage.getItem("wishlist");
    if (saveWish) this.wishlist = JSON.parse(saveWish);

    const save = localStorage.getItem("perfumes");
    if(save) this.listaPerfumes = JSON.parse(save);
    window.addEventListener("keydown", this.teclasForm);
  },
  watch:{
    listaPerfumes:{
¬† ¬† deep:true,
¬† ¬† handler(v){
¬† ¬† ¬† // ESTE √â O COMANDO QUE SALVA NO NAVEGADOR
¬† ¬† ¬† localStorage.setItem("perfumes", JSON.stringify(v));
¬† ¬† }
¬† },

¬† tela(newVal) {
¬† ¬† if (newVal === 'grid') {
¬† ¬† ¬† this.resetar();
¬† ¬† }
¬† },
wishlist:{
  deep:true,
  handler(v){
    localStorage.setItem("wishlist", JSON.stringify(v));
  }
},
  },
  computed:{
    valorTotal(){ 
      return this.listaFiltrada.reduce((t,p)=>t+parseFloat(p.preco||0),0); 
    },
listaFiltrada() {
  const termos = this.filtroGeral
    .toLowerCase()
    .split(" ")
    .filter(t => t.trim() !== "");

  let listaBase = this.listaPerfumes;

  // üî• Se favoritos estiver ativado, filtra primeiro
  if (this.somenteFavoritos) {
    listaBase = listaBase.filter(p => p.favorito);
  }

  // üî• Se n√£o digitou nada, retorna s√≥ os favoritos (ou todos)
  if (termos.length === 0) {
    return listaBase;
  }

  // üîç Busca inteligente (todas as palavras devem bater)
  return listaBase.filter(perfume => {
    const texto = `
      ${perfume.nome}
      ${perfume.marca}
      ${perfume.preco}
      ${perfume.volume}
      ${perfume.ano}
      ${perfume.tempo}
      ${perfume.estacao}
      ${perfume.extras}
      ${perfume.ocasi√µes.join(" ")}
      ${perfume.notasSelecionadas.join(" ")}
    `.toLowerCase();

    return termos.every(t => texto.includes(t));
  });
},
    listaFiltradaSorted(){
      const arr=this.listaFiltrada.slice();
      switch(this.sortBy){
        case 'nome_az': arr.sort((a,b)=>a.nome.localeCompare(b.nome,'pt-BR')); break;
        case 'nome_za': arr.sort((a,b)=>b.nome.localeCompare(a.nome,'pt-BR')); break;
        case 'preco_cresc': arr.sort((a,b)=>a.preco-b.preco); break;
        case 'preco_desc': arr.sort((a,b)=>b.preco-a.preco); break;
        case 'nota_cresc': arr.sort((a,b)=>a.nota-b.nota); break;
        case 'nota_desc': arr.sort((a,b)=>b.nota-a.nota); break;
      }
      return arr;
    },
    podeSalvar(){
      return this.nome && this.marca && this.imagem && this.volume &&
             this.preco && this.site;
    },
    temAlgoNoFormulario() {
  return this.nome || this.marca || this.imagem || this.volume || this.ano ||
         this.preco || this.ocasi√µes.length || this.notasSelecionadas.length ||
         this.tempo || this.estacao || this.extras || this.site;
}

  },
  filters:{
    reais(v){ return "R$ "+parseFloat(v).toFixed(2).replace(".",","); }
  },
  methods:{
  
    toggleAba(a){ this.abasAbertas[a]=!this.abasAbertas[a]; },
teclasForm(e) {
  // ========= CADASTRO =========
  if (this.tela === 'cadastro') {
    // ESC ‚Üí cancelar e voltar para lista
    if (e.key === "Escape") {
      this.cancelarEdicao();
      this.tela = "grid";
    }

    // ENTER ‚Üí salvar
    if (e.key === "Enter") {
      e.preventDefault();
      if (this.podeSalvar) {
        this.cadastrarPerfume();
      }
    }
  }

  // ========= WISHLIST =========
  if (this.tela === 'wishlist') {

    // ESC ‚Üí limpar e voltar para grid
    if (e.key === "Escape") {
      this.wish_nome = '';
      this.wish_marca = '';
      this.wish_preco = '';
      this.wish_imagem = '';
      this.wish_site = '';
      this.tela = 'grid';
    }

    // ENTER ‚Üí adicionar √† wishlist
    if (e.key === "Enter") {
      e.preventDefault();
      this.wishAdicionar();
    }
  }
},
cadastrarPerfume() {
  let fav = false;

  if (this.editIndex !== null)
    fav = this.listaPerfumes[this.editIndex].favorito;

  const perfume = {
    nome: this.nome,
    marca: this.marca,
    imagem: this.imagem,
    volume: this.volume,
    ano: this.ano,
    preco: this.preco,
    ocasi√µes: [...this.ocasi√µes],
    tempo: this.tempo,
    estacao: this.estacao,
    notasSelecionadas: [...this.notasSelecionadas],
    extras: this.extras,
    site: this.site,
    expandido: false,
    nota: this.editIndex !== null ? this.notaTemp : 0,
    favorito: fav
  };

  if (this.editIndex !== null)
    Vue.set(this.listaPerfumes, this.editIndex, perfume);
  else
    this.listaPerfumes.push(perfume);

  this.resetar();
  this.tela = 'grid';
},
irParaLista() {
  this.resetar();        // limpa antes
  this.tela = 'grid';    // muda depois
},

irParaCadastro() {
  this.resetar();        // sempre come√ßa vazio
  this.tela = 'cadastro';
},

abrirImportacao() {
  document.getElementById("importarArquivo").click();
},

alterar(perfume) {
  const indexReal = this.listaPerfumes.indexOf(perfume);

  const p = this.listaPerfumes[indexReal];

  this.tela = 'cadastro';
  this.nome = p.nome;
  this.marca = p.marca;
  this.imagem = p.imagem;
  this.volume = p.volume;
  this.ano = p.ano;
  this.preco = p.preco;
  this.ocasi√µes = [...p.ocasi√µes];
  this.tempo = p.tempo;
  this.estacao = p.estacao;
  this.notasSelecionadas = [...p.notasSelecionadas];
  this.extras = p.extras;
  this.site = p.site;

  this.notaTemp = p.nota;
  this.editIndex = indexReal;
},
// Carregar via input file
carregarImagem(event) {
  const file = event.target.files[0];
  if (file) this.lerArquivo(file);
},

// Soltar arquivo (drag and drop)
soltarImagem(event) {
  const file = event.dataTransfer.files[0];
  if (file) this.lerArquivo(file);
},

// Colar imagem (CTRL+V)
colarImagem(event) {
  const items = event.clipboardData.items;

  for (let i = 0; i < items.length; i++) {
    if (items[i].type.includes("image")) {
      const file = items[i].getAsFile();
      this.lerArquivo(file);
      break;
    }
  }
},

// L√™ qualquer imagem e converte para Base64
lerArquivo(file) {
  const reader = new FileReader();
  reader.onload = (e) => {
    this.imagem = e.target.result; // Base64
  };
  reader.readAsDataURL(file);
},

duplicar(perfume) {
  const indexReal = this.listaPerfumes.indexOf(perfume);

  const clone = JSON.parse(JSON.stringify(this.listaPerfumes[indexReal]));
  clone.expandido = false;
  clone.favorito = false;

  this.listaPerfumes.push(clone);

  this.alterar(clone);
},

cancelarEdicao(){
   this.resetar(); 
   this.tela = 'grid';
},

resetar(){
  this.nome=this.marca=this.imagem=this.volume=this.ano=this.preco='';
  this.ocasi√µes=[]; 
  this.tempo=''; 
  this.estacao='';
  this.notasSelecionadas=[]; 
  this.extras=''; 
  this.site='';
  this.editIndex=null; 
  this.notaTemp=0;
  this.abasAbertas={oc:false,pref:false,notas:false};
},

excluir(perfume) {
  if (!confirm("Tem certeza que deseja excluir este perfume?")) return;

  const indexReal = this.listaPerfumes.indexOf(perfume);
  this.listaPerfumes.splice(indexReal, 1);
},

toggleExpand(p){
  const aberto=p.expandido;
  this.listaPerfumes.forEach(x=>x.expandido=false);
  p.expandido=!aberto;
},

setNotaPerfume(perfume, n) {
  const indexReal = this.listaPerfumes.indexOf(perfume);
  if (indexReal !== -1) {
    this.listaPerfumes[indexReal].nota = n;
    this.notaTemp = n;
  }
},


toggleFavorito(p){ p.favorito=!p.favorito; },

badgeColorOc(o){
  return {
    "Dia a Dia":"primary","Profissional":"dark","Balada":"purple",
    "Encontro":"red","Faculdade":"green","Academia":"orange",
    "Casamento":"yellow","Happy Hour":"cyan"
  }[o] || "secondary";
},

exportarColecaoCompleta() {

    if (!confirm("Deseja realmente exportar toda a cole√ß√£o e lista de desejos?")) {
        return;
    }

    const dados = {
        colecao: this.listaPerfumes,
        wishlist: this.wishlist
    };

    const blob = new Blob([JSON.stringify(dados, null, 2)], { type: "application/json" });
    const url = URL.createObjectURL(blob);

    const a = document.createElement("a");
    a.href = url;
    a.download = "colecao_completa.json";
    a.click();

    URL.revokeObjectURL(url);

    alert("Cole√ß√£o exportada com sucesso!");
},

importarColecaoCompleta(event) {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();

    reader.onload = (e) => {
        try {
            const dados = JSON.parse(e.target.result);

            const colecaoImportada = dados.colecao || [];
            const wishlistImportada = dados.wishlist || [];

            this.mesclarPerfumes(colecaoImportada, "listaPerfumes");
            this.mesclarPerfumes(wishlistImportada, "wishlist");

            alert("Cole√ß√£o importada com sucesso!");

        } catch (erro) {
            alert("Erro ao importar arquivo.");
        }
    };

    reader.readAsText(file);
},

mesclarPerfumes(lista, destino) {
    lista.forEach(p => {
        const existe = this[destino].some(x =>
            x.nome.toLowerCase() === p.nome.toLowerCase() &&
            x.marca.toLowerCase() === p.marca.toLowerCase()
        );

        if (!existe) {
            this[destino].push(p);
        }
    });
},

badgeColorNota(n){
  return{
    "Amadeirado":"brown","C√≠trico":"yellow","Doce":"pink",
    "Fresco":"skyblue","Oriental":"red","Especiado":"orange",
    "Aqu√°tico / Marinho":"cyan","Arom√°tico":"green",
    "Frutado":"purple","Herbal":"darkgreen"
  }[n] || "secondary";
},
irParaWishlist() {
  this.tela = 'wishlist';
},
wish_carregarImagem(e){
  const file = e.target.files[0];
  const reader = new FileReader();
  reader.onload = r => this.wish_imagem = r.target.result;
  reader.readAsDataURL(file);
},
wishAdicionar(){
  if(!this.wish_nome || !this.wish_marca || !this.wish_preco || !this.wish_imagem){
    alert("Preencha todos os campos!");
    return;
  }

this.wishlist.push({
  nome: this.wish_nome,
  marca: this.wish_marca,
  preco: this.wish_preco,
  imagem: this.wish_imagem,
  site: this.wish_site
});

  this.wish_site = '';
  this.wish_nome = '';
  this.wish_marca = '';
  this.wish_preco = '';
  this.wish_imagem = '';
},
wishMoverParaColecao(p){

  if (!confirm("Deseja mover este perfume para a sua cole√ß√£o?")) {
    return;
  }

  this.listaPerfumes.push({
    nome: p.nome,
    marca: p.marca,
    preco: p.preco,
    imagem: p.imagem,
    volume: '',
    ano: '',
    site: p.site || '',
    ocasi√µes: [],
    tempo: '',
    estacao: '',
    notasSelecionadas: [],
    extras: '',
    nota: 0,
    favorito: false,
    expandido: false
  });

  this.wishExcluir(p, false);

  alert("Movido para a cole√ß√£o!");
},
wishExcluir(p, confirmar = true) {
  if (confirmar && !confirm("Tem certeza que deseja remover este perfume da lista de desejos?")) {
    return;
  }

  const i = this.wishlist.indexOf(p);
  this.wishlist.splice(i, 1);
},
// ====== WISHLIST ‚Äî Upload de imagem igual ao formul√°rio ======
wish_carregarImagem(event) {
  const file = event.target.files[0];
  if (file) this.wish_lerArquivo(file);
},

wish_soltarImagem(event) {
  const file = event.dataTransfer.files[0];
  if (file) this.wish_lerArquivo(file);
},

wish_colarImagem(event) {
  const items = event.clipboardData.items;

  for (let i = 0; i < items.length; i++) {
    if (items[i].type.includes("image")) {
      const file = items[i].getAsFile();
      this.wish_lerArquivo(file);
      break;
    }
  }
},

wish_lerArquivo(file) {
  const reader = new FileReader();
  reader.onload = (e) => {
    this.wish_imagem = e.target.result; // Base64
  };
  reader.readAsDataURL(file);
},
}
});
</script>

</body>
</html>
