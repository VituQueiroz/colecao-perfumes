<!DOCTYPE html>
<html lang="pt-br" data-bs-theme="dark">
<head>
<meta charset="UTF-8" />

<!-- üî• IMPORTANTE PARA CELULAR -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Cole√ß√£o de Perfumes</title>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
<script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
<link rel="icon" type="image/png" href="https://icons.iconarchive.com/icons/iconarchive/mothers-day/48/Perfume-Bottle-icon.png">
<link rel="stylesheet" href="style.css">

</head>

<body>
<div id="app">

<nav class="navbar navbar-dark bg-dark mb-3 rounded shadow p-2">
  <div class="container-fluid">
    <a class="navbar-brand" href="#" @click.prevent="irParaLista">
      <i class="fa fa-th"></i> Lista
    </a>
    
    <a class="navbar-brand" href="#" @click.prevent="irParaCadastro">
      <i class="fa fa-plus"></i> Cadastro
    </a>
    
    <a class="navbar-brand" href="#" @click.prevent="irParaWishlist">
    <i class="fa fa-star"></i> Lista de Desejos
    </a>

  </div>
</nav>

<div class="container py-3">

<header class="text-center mb-3">
    <h1 style="font-size:1.6rem;">Minha Cole√ß√£o de Perfumes</h1>
</header>

<div class="row g-3">

<!-- ========================= -->
<!--   FORMUL√ÅRIO CENTRALIZADO -->
<!-- ========================= -->
<div v-if="tela==='cadastro'" class="d-flex justify-content-center w-100">
  <div class="col-12 col-md-3">
    <div class="glass-box">

      <h2 style="font-size:1.1rem;">{{ editIndex !== null ? "Editar Perfume" : "Cadastrar Perfume" }}</h2>

      <label class="mt-2">Nome <span class="obrigatorio">*</span></label>
      <input class="form-control" placeholder="Nome" v-model="nome">

      <label class="mt-2">Marca <span class="obrigatorio">*</span></label>
      <input class="form-control" placeholder="Marca" v-model="marca">

      <label class="mt-2">Site fabricante <span class="obrigatorio">*</span></label>
      <input class="form-control" placeholder="Site fabricante" v-model="site">

<!-- √ÅREA DE UPLOAD -->
<div class="upload-area mt-2"
     @dragover.prevent
     @drop.prevent="soltarImagem"
     @paste="colarImagem">

     <p class="mb-1" style="font-size:0.8rem;">
      <span class="obrigatorio">*</span> Arraste a imagem aqui, clique para escolher ou use CTRL+V
    </p>
    

  <input type="file" accept="image/*" class="d-none" ref="fileInput" @change="carregarImagem">
  
  <div class="upload-box" @click="$refs.fileInput.click()">
    <i class="fa fa-cloud-upload fa-2x mb-2"></i>
    <p>Clique ou solte a imagem aqui</p>
  </div>
</div>

<!-- Pr√©-visualiza√ß√£o com √≠cone de remover -->
<div v-if="imagem" class="position-relative d-inline-block mt-2">
  <img :src="imagem" class="img-fluid rounded shadow" style="max-height:120px;">
  
  <!-- √çcone para remover -->
  <span @click="imagem=''" 
        style="position:absolute; top:0; right:0; background:rgba(0,0,0,0.6); 
               border-radius:50%; padding:2px 6px; cursor:pointer; color:white;">
    <i class="fas fa-times"></i>
  </span>
</div>



      <label class="mt-2">Volume (ml) <span class="obrigatorio">*</span></label>
      <input class="form-control" type="number" placeholder="Volume (ml)" v-model="volume">

      <input class="form-control mt-2" type="number" placeholder="Ano lan√ßamento" v-model="ano">
      <label class="mt-2">Pre√ßo (R$) <span class="obrigatorio">*</span></label>
      <input class="form-control" type="number" placeholder="Pre√ßo (R$)" v-model="preco">


      <!-- ACCORDIONS -->
      <div class="accordion mt-3" id="accordionForm">

<div class="accordion-item bg-transparent">
  <h2 class="accordion-header">
    <button class="accordion-button" type="button" @click="toggleAba('oc')">
      Ocasi√µes
    </button>
  </h2>

  <div :class="'accordion-collapse collapse ' + (abasAbertas.oc ? 'show' : '')">
    <div class="accordion-body">
      
      <div v-for="oc in opcoesOcasi√µes" :key="oc" class="form-check">
        <input 
          class="form-check-input"
          type="checkbox"
          :id="'oc-' + oc"
          :value="oc"
          v-model="ocasi√µes"
        >
        <label class="form-check-label" :for="'oc-' + oc">
          {{ oc }}
        </label>
      </div>

    </div>
  </div>
</div>


        <div class="accordion-item bg-transparent mt-2">
          <h2 class="accordion-header">
            <button class="accordion-button" type="button" @click="toggleAba('pref')">Prefer√™ncias</button>
          </h2>
          <div :class="'accordion-collapse collapse ' + (abasAbertas.pref ? 'show':'' )">
            <div class="accordion-body">
              <select class="form-control mt-1" v-model="tempo">
                <option disabled value="">Dia ou Noite?</option>
                <option>Dia</option>
                <option>Noite</option>
              </select>
              <select class="form-control mt-1" v-model="estacao">
                <option disabled value="">Frio ou Calor?</option>
                <option>Frio</option>
                <option>Calor</option>
              </select>
            </div>
          </div>
        </div>

<div class="accordion-item bg-transparent mt-2">
  <h2 class="accordion-header">
    <button class="accordion-button" type="button" @click="toggleAba('notas')">
      Notas Olfativas
    </button>
  </h2>

  <div :class="'accordion-collapse collapse ' + (abasAbertas.notas ? 'show' : '')">
    <div class="accordion-body">
      
      <div v-for="nota in opcoesNotasAromaticas" :key="nota" class="form-check">
        <input 
          class="form-check-input"
          type="checkbox"
          :id="'nota-' + nota"
          :value="nota"
          v-model="notasSelecionadas"
        >
        <label class="form-check-label" :for="'nota-' + nota">
          {{ nota }}
        </label>
      </div>

    </div>
  </div>
</div>


      </div>

      <h5 class="mt-3">Extras</h5>
      <input class="form-control" v-model="extras">

      <button class="btn btn-primary w-100 mt-3" :disabled="!podeSalvar" @click="cadastrarPerfume">
        {{ editIndex !== null ? "Salvar Altera√ß√µes" : "Cadastrar Perfume" }}
      </button>

      <button class="btn btn-secondary w-100 mt-2" 
        v-if="temAlgoNoFormulario" 
        @click="cancelarEdicao">
        Cancelar
      </button>


      <button class="btn btn-success w-100 mt-2" @click="exportarColecaoCompleta">
        Exportar Cole√ß√£o
      </button>

      <input type="file" id="importarArquivo" style="display:none" @change="importarColecaoCompleta">

      <button class="btn btn-warning w-100 mt-2" @click="abrirImportacao">
        Importar Cole√ß√£o
      </button>

    </div>
  </div>
</div>

<!-- ============================= -->
<!--     GRID CENTRALIZADO        -->
<!-- ============================= -->
<div v-if="tela==='grid'" class="d-flex justify-content-center w-100">
<div class="col-12 col-md-9">
  <div class="glass-box">

    <div class="d-flex gap-2 mb-2 align-items-center">
      <input class="form-control" placeholder="Buscar..." v-model="filtroGeral" style="font-size:0.85rem;">

      <select class="form-control w-auto" v-model="sortBy" style="font-size:0.85rem;">
        <option value="none">Ordenar</option>
        <option value="nome_az">Nome (A ‚Üí Z)</option>
        <option value="nome_za">Nome (Z ‚Üí A)</option>
        <option value="preco_cresc">Menor Pre√ßo</option>
        <option value="preco_desc">Maior Pre√ßo</option>
        <option value="nota_cresc">Menor Nota</option>
        <option value="nota_desc">Maior Nota</option>
      </select>

      <label class="form-check-label ms-2" style="color:#fff;">
        <input class="form-check-input" type="checkbox" v-model="somenteFavoritos">
        Favoritos
      </label>
    </div>

    <div class="mb-2" style="font-size:0.8rem;">
      <strong>Total:</strong> {{ listaFiltrada.length }} |
      <strong>Valor:</strong> {{ valorTotal | reais }}
    </div>

    <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-3 justify-content-center">

      <div class="col" v-for="(perfume,index) in listaFiltradaSorted" :key="index">
        <div class="card-wrap">
          <div class="perfume-card" @click="toggleExpand(perfume)">

            <div v-if="!perfume.expandido" class="favorite" @click.stop="toggleFavorito(perfume)">
              <i :class="perfume.favorito ? 'fas fa-heart':'far fa-heart'"></i>
            </div>

            <div v-if="!perfume.expandido" class="text-center">
              <img :src="perfume.imagem" class="perfume-img mb-2">
              <h5>{{ perfume.nome }}</h5>
              <p class="mb-1"><strong>{{ perfume.preco | reais }}</strong></p>
              <p class="mb-0">
                <span v-for="n in 5" :key="n"
                  class="fa-star star"
                  :class="{'fas': n <= perfume.nota, 'far': n > perfume.nota}"
                  @click.stop="setNotaPerfume(perfume,n)">
                </span>
              </p>
            </div>

            <div class="collapse-content" :class="{'show': perfume.expandido}">
              <a v-if="perfume.site" :href="perfume.site" target="_blank" class="btn btn-success btn-sm position-absolute top-0 end-0 mt-1 me-1" title="Comprar">
                  <i class="fas fa-shopping-cart"></i>
                </a>

              <p><strong>Marca:</strong> {{ perfume.marca }}</p>
              <p><strong>Volume:</strong> {{ perfume.volume }} ml</p>
              <p><strong>Ano:</strong> {{ perfume.ano }}</p>
              <p><strong>Dia/Noite:</strong> {{ perfume.tempo }}</p>
              <p><strong>Esta√ß√£o:</strong> {{ perfume.estacao }}</p>

              <p><strong>Ocasi√µes:</strong><br>
                <span v-for="oc in perfume.ocasi√µes" :key="oc"
                      class="badge badge-oc" :class="'bg-' + badgeColorOc(oc)">
                {{ oc }}</span>
              </p>

              <p><strong>Notas:</strong><br>
                <span v-for="nota in perfume.notasSelecionadas" :key="nota"
                      class="badge badge-nota" :class="'bg-' + badgeColorNota(nota)">
                {{ nota }}</span>
              </p>

              <p><strong>Extras:</strong><br>
                <span class="badge badge-cat">{{ perfume.extras }}</span>
              </p>
            </div>

            <div class="button-row">
              <button class="btn btn-info btn-sm" @click.stop="duplicar(perfume)">Duplicar</button>
              <button class="btn btn-danger btn-sm" @click.stop="excluir(perfume)">Excluir</button>
              <button class="btn btn-success btn-sm" @click.stop="alterar(perfume)">Editar</button>
            </div>

          </div>
        </div>
      </div>

    </div>
  </div>
</div>
</div>

</div> <!-- row -->


<!-- ============================= -->
<!--     TELA LISTA DE DESEJOS     -->
<!-- ============================= -->
<div v-if="tela==='wishlist'" class="row justify-content-center w-100">

  <div class="col-12 col-md-3">
    <div class="glass-box">

      <h2 style="font-size:1.1rem;">Adicionar √† Lista de Desejos</h2>

      <label class="mt-2">Nome</label>
      <input class="form-control" v-model="wish_nome">

      <label class="mt-2">Marca</label>
      <input class="form-control" v-model="wish_marca">

      <label class="mt-2">Pre√ßo (R$)</label>
      <input class="form-control" type="number" v-model="wish_preco">

      <label class="mt-2">Link de Compra</label>
      <input class="form-control" placeholder="https://..." v-model="wish_site">


<!-- √ÅREA DE UPLOAD (mesma do cadastro) -->
<div class="upload-area mt-2"
     @dragover.prevent
     @drop.prevent="wish_soltarImagem"
     @paste="wish_colarImagem">

  <p class="mb-1" style="font-size:0.8rem;">
    <span class="obrigatorio">*</span> Arraste a imagem aqui, clique para escolher ou use CTRL+V
  </p>

  <input type="file" accept="image/*" class="d-none" ref="wish_fileInput" @change="wish_carregarImagem">

  <div class="upload-box" @click="$refs.wish_fileInput.click()">
    <i class="fa fa-cloud-upload fa-2x mb-2"></i>
    <p>Clique ou solte a imagem aqui</p>
  </div>
</div>

<!-- Pr√©-visualiza√ß√£o com √≠cone de remover -->
<div v-if="wish_imagem" class="position-relative d-inline-block mt-2">
  <img :src="wish_imagem" class="img-fluid rounded shadow" style="max-height:120px;">

  <span @click="wish_imagem=''" 
        style="position:absolute; top:0; right:0; background:rgba(0,0,0,0.6); 
               border-radius:50%; padding:2px 6px; cursor:pointer; color:white;">
    <i class="fas fa-times"></i>
  </span>
</div>


      <button class="btn btn-primary w-100 mt-3" @click="wishAdicionar">
        Adicionar
      </button>

    </div>
  </div>

  <!-- LISTA LATERAL -->
  <div class="col-12 col-md-6">
    <div class="glass-box">

      <h4>Itens na Lista de Desejos</h4>

      <div class="row row-cols-2 row-cols-md-3 g-3 mt-2">

        <div class="col" v-for="(p,i) in wishlist" :key="i">
          <div class="perfume-card text-center">

            <img :src="p.imagem" class="perfume-img mb-2">
            <h5>{{ p.nome }}</h5>
            <p>{{ p.marca }}</p>
            <p><strong>{{ p.preco | reais }}</strong></p>
            <a v-if="p.site"
              :href="p.site"
              target="_blank"
              class="btn btn-success btn-sm mb-1"
              title="Comprar">
              <i class="fas fa-shopping-cart"></i> Comprar
            </a>

            <button class="btn btn-success btn-sm mb-1" @click="wishMoverParaColecao(p)">
              Mover para a Cole√ß√£o
            </button>

            <button class="btn btn-danger btn-sm" @click="wishExcluir(p)">
              Remover
            </button>

          </div>
        </div>

      </div>

    </div>
  </div>

</div>
</div> <!-- container -->
<script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
<script src="app.js"></script>
</body>
</html>
